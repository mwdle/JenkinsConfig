jenkins:
  systemMessage: "${systemMessage}"
  noUsageStatistics: true
  slaveAgentPort: -1 # Docker Plugin attaches directly to dynamic agent containers, thus agent port is not needed.
  securityRealm:
    local:
      allowsSignup: false
      enableCaptcha: false
      users:
        - id: "${JENKINS_ADMIN_USER}"
          password: "${JENKINS_ADMIN_PASSWORD}"
          properties:
            - theme:
                theme: "darkSystem" # Requires plugin `dark-theme` - see `Dockerfile`

  authorizationStrategy: # IMPORTANT: This configuration assumes a single user instance. If this instance will have more than one user or the users are not fully trusted, this authorization strategy MUST BE REPLACED with something more secure.
    loggedInUsersCanDoAnything:
      allowAnonymousRead: false
  disableRememberMe: true # Disable "Keep me signed in‚Äù

  crumbIssuer: "standard"
  mode: NORMAL
  numExecutors: 0 # No executors on built-in node

  clouds:
    - docker:
        name: "docker"
        containerCap: 100 # Default is 100, adjust as needed
        dockerApi:
          dockerHost:
            uri: "${DOCKER_HOST}" # docker-socket-proxy container name defined in compose.yaml
          connectTimeout: 30
        templates:
          - connector:
              attach:
                user: "jenkins"
            dockerTemplateBase:
              image: jenkins-agent:local # Custom container image defined in Dockerfile.agent and built to host's Docker cache via compose.yaml
              network: "DockerProxy" # DockerProxy network for docker-socket proxy container -- See compose.yaml
              environment:
                - "DOCKER_HOST=${DOCKER_HOST}"
                - "BITWARDEN_SERVER_URL=${BITWARDEN_SERVER_URL}"
            labelString: "docker"
            mode: EXCLUSIVE
            name: "docker"
            remoteFs: "/home/jenkins"

credentials:
  system:
    domainCredentials:
      - credentials:
          - usernamePassword:
              scope: GLOBAL
              id: "git-creds"
              username: "${GIT_USERNAME}"
              password: "${GIT_TOKEN}"
              description: "Gitea credentials for organization folder"
          - usernamePassword:
              scope: GLOBAL
              id: "bitwarden"
              username: "${BITWARDEN_CLIENTID}"
              password: "${BITWARDEN_CLIENTSECRET}"
              description: "Bitwarden CLI API Credentials"
          - string:
              scope: GLOBAL
              id: "bitwardenPassword"
              secret: "${BITWARDEN_MASTER_PASSWORD}"
              description: "Bitwarden CLI Master Password"

unclassified:
  location:
    url: "${JENKINS_URL}"
    adminAddress: "${ADMIN_ADDRESS}"

  giteaServers:
    servers:
      - credentialsId: git-creds
        displayName: scm
        manageHooks: true
        serverUrl: ${GIT_SERVER_URL}

  mailer:
    replyToAddress: ${REPLY_TO_EMAIL}
    smtpHost: ${SMTP_HOST}
    smtpPort: 465
    useSsl: true
    authentication:
      username: ${SMTP_USERNAME}
      password: ${SMTP_PASSWORD}

  buildDiscarders:
    configuredBuildDiscarders:
      - "jobBuildDiscarder"
      - simpleBuildDiscarder:
          discarder:
            logRotator:
              numToKeepStr: "1000000"
              daysToKeepStr: "730"

jobs:
  - file: /var/jenkins_home/JCasC/orgfolder.groovy
